#!/bin/bash

#==============================================================================
# JELLYMAC CONFIGURATION
#==============================================================================

################################################################################
# QUICK START: Configure these essential paths first
################################################################################

# === REQUIRED PATHS (Must be configured before first run) ===
DROP_FOLDER="$HOME/Downloads/ServerDrop"                 # Watch folder for Movies and TV Shows
DEST_DIR_MOVIES="/Volumes/Users/User/Videos/Movies"                   # Your Movies library folder (if using a separate server, set to your network share drive library e.g. /Volumes/Media/Movies)
DEST_DIR_SHOWS="/Volumes/Users/User/Videos/Shows"                     # Your Shows library folder (if using a separate server, set to your network share drive library e.g. /Volumes/Media/Shows) 
DEST_DIR_YOUTUBE="$HOME/Movies/YouTube"                 # Your YouTube library folder

# === JELLYFIN SERVER (Optional - leave blank to disable) ===
JELLYFIN_SERVER="http://your-jellyfin-server-ip:8096"   # Your Jellyfin server URL
JELLYFIN_API_KEY="your-jellyfin-api-key-here"           # Generate in Jellyfin â†’ API Keys

# === FEATURES ===
ENABLE_TORRENT_AUTOMATION="true"                        # Process magnet links automatically? (true/false)
ENABLE_CLIPBOARD_MAGNET="true"                          # Watch clipboard for magnet links? (true/false)
ENABLE_CLIPBOARD_YOUTUBE="true"                         # Watch clipboard for YouTube links? (true/false)
SOUND_NOTIFICATION="true"                               # Play sounds for events? (true/false)
SHOW_STARTUP_BANNER="true"                                   

################################################################################
# SYSTEM CONFIGURATION (Works well with defaults - modify only if needed)
################################################################################

# === CRITICAL EARLY-LOADING VARIABLES (DO NOT MOVE) ===
CONFIG_FILE_OWN_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd)"
JELLYMAC_PROJECT_ROOT="$(cd "${CONFIG_FILE_OWN_DIR}/.." && pwd)"

# === CORE SYSTEM SETTINGS ===
LOG_DIR="${JELLYMAC_PROJECT_ROOT}/logs"
AUTO_INSTALL_DEPENDENCIES="false"
MAIN_LOOP_SLEEP_INTERVAL=2                               # Seconds between input checks
AUTO_CREATE_MISSING_DIRS="true"
MAX_CONCURRENT_PROCESSORS="2"                            # Maximum number of concurrent media processors (1-4 recoommended for most systems)
                               
#==============================================================================
# LOGGING & HISTORY
#==============================================================================

LOG_LEVEL="INFO"                                         # DEBUG, INFO, WARN, ERROR
LOG_ROTATION_ENABLED="true"                              # Enable daily log rotation
LOG_FILE_BASENAME="jellymac_log"                         # Base name for log files
LOG_RETENTION_DAYS="7"                                   # Days to keep old log files
HISTORY_FILE="${JELLYMAC_PROJECT_ROOT}/.jellymac_history.log"

#==============================================================================
# ERROR HANDLING & STATE
#==============================================================================

ERROR_DIR="${JELLYMAC_PROJECT_ROOT}/_error_quarantine_files"
STATE_DIR="${JELLYMAC_PROJECT_ROOT}/.state"

#==============================================================================
# MEDIA PROCESSING
#==============================================================================

# File Extensions
MAIN_MEDIA_EXTENSIONS=(".mkv" ".mp4" ".avi" ".mov" ".wmv" ".flv" ".webm")
ASSOCIATED_FILE_EXTENSIONS=(".srt" ".sub" ".ass" ".idx" ".vtt" ".nfo")

# Filename Cleaning
# To add new tags: separate with | (pipe character). Example: "NewTag|AnotherTag"
# To customize: modify the list below, keeping existing tags or removing unwanted ones
MEDIA_TAG_BLACKLIST="1080p|720p|480p|2160p|WEB[- ]?DL|WEBRip|BluRay|BRRip|HDRip|DDP5?\.1|AAC|AC3|x265|x264|HEVC|H\.264|H\.265|REMUX|NeoNoir"

# Transfer Settings
PERFORM_POST_TRANSFER_DELETE="true"  # Delete source files after successful transfer to destination
POST_TRANSFER_DELETE_DELAY=30        # Wait time (seconds) before deleting source files
RSYNC_TIMEOUT=600                    # Network transfer timeout in seconds

# File Stability Detection
# These settings prevent processing files that are still being written/transferred
STABLE_CHECKS_DROP_FOLDER="3"           # Number of checks to verify file isn't growing
STABLE_SLEEP_INTERVAL_DROP_FOLDER="10"  # Seconds between stability checks

#==============================================================================
# JELLYFIN INTEGRATION
#==============================================================================
# These settings control automatic library scanning after media is processed
# Set to "false" to disable scanning for specific media types (enable if using Jellyfin)

ENABLE_JELLYFIN_SCAN_MOVIES="false"      # Scan Movie library after adding new movies
ENABLE_JELLYFIN_SCAN_SHOWS="false"       # Scan Shows library after adding new shows  
ENABLE_JELLYFIN_SCAN_YOUTUBE="false"     # Scan YouTube library after adding new videos

#==============================================================================
# TORRENT AUTOMATION
#==============================================================================
# Configure connection to Transmission for automatic torrent processing

TORRENT_CLIENT_CLI_PATH="/opt/homebrew/bin/transmission-remote"     # Path to transmission-remote
TRANSMISSION_REMOTE_HOST="localhost:9091"                           # Host:port of transmission daemon
TRANSMISSION_REMOTE_AUTH=""                                         # Leave blank if no auth required
                                                                    # Format: "username:password" if needed

#==============================================================================
# YOUTUBE PROCESSING
#==============================================================================
# Local staging area and download settings for YouTube content

LOCAL_DIR_YOUTUBE="${JELLYMAC_PROJECT_ROOT}/.temp_youtube"          # Temporary download location
DOWNLOAD_ARCHIVE_YOUTUBE="${JELLYMAC_PROJECT_ROOT}/.yt_download_archive.txt"  # Prevents re-downloading
COOKIES_ENABLED="false"                                         # Enable for age-restricted/private videos
COOKIES_FILE="/path/to/your/cookies.txt"                       # Export from browser if cookies enabled
YTDLP_FORMAT="bv[height<=1080][vcodec=vp9]+ba[acodec=opus]/bv[height<=1080]+ba/best"  # Video quality preference (default is good quality/file size balance)
YTDLP_OPTS=(
    --no-playlist                    # Download single video only, not entire playlist
    --merge-output-format mp4        # Combine video/audio into .mp4 container
    --embed-metadata                 # Include video title, description in file
    --embed-thumbnail                # Embed video thumbnail as cover art
    --restrict-filenames             # Use only safe characters in filenames
 #  --sponsorblock-remove all        # Remove sponsored segments automatically
 #  --write-subs                     # Download subtitles if available (creates separate .srt or .vtt files)
 #  --sub-langs "en.*,en,es"         # Preferred subtitle languages (e.g., all English variants, then Spanish)
 #  --write-auto-subs                # Download automatic (generated) subtitles if no human-made ones are available
 #  --convert-subs srt               # Convert subtitles to SRT format if downloaded in another format
 #  --ppa "EmbedSubtitle"            # Attempts to embed downloaded subtitles into the file (experimental for mp4, works well with mkv)
)
# Add custom yt-dlp options above. See: https://github.com/yt-dlp/yt-dlp#usage-and-options

#==============================================================================
# USER INTERFACE
#==============================================================================
# Controls visual and audio feedback during operation

ENABLE_DESKTOP_NOTIFICATIONS="true"                            # Show macOS notifications for events
ENABLE_STARTUP_BANNER="true"                                   # Display ASCII art banner on startup
SOUND_INPUT_DETECTED_FILE="/System/Library/Sounds/Funk.aiff"   # Sound when new input detected
SOUND_TASK_SUCCESS_FILE="/System/Library/Sounds/Glass.aiff"    # Sound for successful operations
SOUND_TASK_ERROR_FILE="/System/Library/Sounds/Basso.aiff"      # Sound for errors